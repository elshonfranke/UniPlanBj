{% extends "base.html" %}

{% block title %}Connexion - UniPlanBJ{% endblock %}

{% block head_extra %}
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <!-- On lie le fichier CSS externe pour une meilleure organisation et performance -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
{% endblock %}

{% block body_class %}auth-page{% endblock %}

{% block content %}
    <div class="container">
      <!-- Le formulaire doit avoir une méthode (POST) et une action pour fonctionner -->
      <form method="POST" action="{{ url_for('main.login') }}">
        <h1>Se connecter</h1>

        <!-- Bloc pour afficher les messages d'erreur ou de succès -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-container">
                    {% for category, message in messages %}
                        <!-- La classe 'flash-message' est stylisée dans le CSS externe -->
                        <div class="flash-message">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="input-box">
          <!-- L'attribut 'name' est crucial pour que Flask récupère la donnée -->
          <input type="email" name="email" required placeholder="Email"/>
          <i class="bx bxs-user"></i> 
        </div>
        <div class="input-box">
          <!-- Correction du typo et ajout de l'attribut 'name' -->
          <input type="password" name="password" required placeholder="Mot de passe" id="password"/>
           <i class="bx bxs-hide password-toggle"></i> 
        </div>

        <div class="remember-forgot">
          <label><input type="checkbox" name="remember" /> Se souvenir de moi</label>
          <a href="{{ url_for('main.request_reset_token') }}">Mot de passe oublié?</a>
        </div>

        <button type="submit" class="btn">Connexion</button>

        <div class="register-link">
          <p>Pas encore de compte ? <a href="{{ url_for('main.signup') }}">Inscrivez-vous</a></p>
        </div>
      </form>
    </div>
{% endblock %}

{% block scripts %}
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const passwordToggles = document.querySelectorAll('.password-toggle');

        passwordToggles.forEach(toggle => {
            toggle.addEventListener('click', () => {
                const passwordInput = toggle.previousElementSibling;
                if (passwordInput && (passwordInput.type === 'password' || passwordInput.type === 'text')) {
                    // Basculer le type de l'input
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);

                    // Basculer l'icône de bxs-hide à bxs-show et vice-versa
                    toggle.classList.toggle('bxs-hide');
                    toggle.classList.toggle('bxs-show');
                }
            });
        });
      });
    </script>
{% endblock %}